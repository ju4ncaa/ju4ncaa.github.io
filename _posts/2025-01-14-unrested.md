---
description: >-
  Writeup de la máquina de dificultad media Unrested de la página https://hackthebox.eu
title: Hack The Box - Unrested | (Difficulty Medium) - Linux
date: 2025-01-14 00:00:00 +0800
categories: [Hack the Box, Writeup]
tags: [htb, hacking, hack the box, linux, zabbix, medium, writeup, redteam, pentesting]
image_post: true
image: https://github.com/user-attachments/assets/56f30de2-eed2-4dc1-83a9-68b49acab64a
---

## Useful Skills

* Web enumeration
* Abusing Zabbix Server SQL Injection Vulnerability (CVE-2024-42327)
* Abusing sudo privileges (/usr/bin/nmap)
  
## Enumeration

### TCP Scan

 ```bash
rustscan -a 10.10.11.50 --ulimit 5000 -g
10.10.11.50 -> [22,80,10050,10051
```

```bash
nmap -p22,80,10050,10051 -sCV 10.10.11.50 -oN tcpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-14 16:28 CET
Nmap scan report for 10.10.11.50 (10.10.11.50)
Host is up (0.041s latency).

PORT      STATE SERVICE             VERSION
22/tcp    open  ssh                 OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
80/tcp    open  http                Apache httpd 2.4.52 ((Ubuntu))
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
10050/tcp open  tcpwrapped
10051/tcp open  ssl/zabbix-trapper?
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.26 second
```

### UDP Scan

 ```bash
nmap -sU --top-ports 1500 --min-rate 5000 -n -Pn 10.10.11.50 -oN udpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-14 16:30 CET
Nmap scan report for 10.10.11.50
Host is up (0.040s latency).
Not shown: 1494 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
983/udp   closed unknown
9877/udp  closed unknown
19719/udp closed unknown
21016/udp closed unknown
30209/udp closed unknown
60381/udp closed unknown

Nmap done: 1 IP address (1 host up) scanned in 0.89 seconds
```

### HTTP Enumeration

> Los puertos 10050 y 10051 pertenecen al servicio Zabbix, ya que son los puertos por defecto que usa para comunicarse con los agentes
{: .prompt-info }

![imagen](https://github.com/user-attachments/assets/5ba0341c-ee15-4841-a505-9007f82ee938)

Whatweb reporta que el servicio web que se encuentran en el puerto 80/TCP es el panel de autenticación de Zabbix.

```bash
whatweb http://10.10.11.50
http://10.10.11.50 [200 OK] Apache[2.4.52], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[10.10.11.50], Meta-Refresh-Redirect[/zabbix/]
http://10.10.11.50/zabbix/ [200 OK] Apache[2.4.52], Cookies[zbx_session], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], HttpOnly[zbx_session], IP[10.10.11.50], Meta-Author[Zabbix SIA], PasswordField[password], Script, Title[Unrested: Zabbix], UncommonHeaders[x-content-type-options], X-Frame-Options[SAMEORIGIN], X-UA-Compatible[IE=Edge], X-XSS-Protection[1; mode=blo
```

> HackTheBox proporciona una credenciales de inicio para autenticarse en Zabbix: matthew / 96qzn0h2e1k3
{: .prompt-info }

![imagen](https://github.com/user-attachments/assets/f0b55de6-fa0e-48fe-bc87-8992226f447b)

Una vez dentro del panel de Zabbix se puede observar en el footer la versión, la cual es 7.0.0

![imagen](https://github.com/user-attachments/assets/4a9db3cd-82ca-40e2-9e2d-a7a8b0213821)

> Tener conocimiento sobre la versión de Zabbix nos permite buscar información sobre posibles vulnerabilidades existentes
{: .prompt-warning }

## Vulnerability analysis

### Zabbix Server SQL Injection Vulnerability (CVE-2024-42327)

Una pequeña búsqueda en internet permite dar con la vulnerabilidad CVE-2024-42327, se trata de una inyección SQL en la clase CUser en la función addRelatedObjects, donde los atacantes con permisos de usuario predeterminados o acceso a la API pueden llamar a la función CUser.get, esto podría llevar al acceso no autorizado a información sensible o a la ejecución de declaraciones SQL arbitrarias.

* [NSFocus Explanation CVE-2024-42327](https://nsfocusglobal.com/zabbix-server-sql-injection-vulnerability-cve-2024-42327/)

## Exploitation

### Abusing Zabbix Server SQL Injection Vulnerability (CVE-2024-42327)

> Zabbix es un software de código abierto, podemos acceder a CUser.php y visualizar los snippets de cuando era vulnerable
{: .prompt-tip }

![imagen](https://github.com/user-attachments/assets/9b6ab83e-f1d9-4c47-88ec-e3ffed5ecb94)

En GitHub encontramos un repositorio el cual permite automatizar la explotación de CVE-2024-42327 a través de un script en Python, podemos ejecutarlo o realizar la explotación de forma manual

* [CVE-2024-42327 Exploit GtiHub](https://github.com/aramosf/cve-2024-42327)

![imagen](https://github.com/user-attachments/assets/82037303-760e-4fca-b30c-a333d7679de8)
 
> La API de Zabbix se encuentra en http://10.10.11.50/zabbix/api_jsonrpc.php
{: .prompt-info }

* [Zabbix API Documentation](https://www.zabbix.com/documentation/current/en/manual/api)

![imagen](https://github.com/user-attachments/assets/c4501e92-93d0-4296-8e1a-64009f82ce9e)
