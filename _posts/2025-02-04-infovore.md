---
description: >-
  Writeup de la máquina de dificultad media Infovore de la página https://vulnhub.com
title: VulnHub - Infovore | (Difficulty Medium) - Linux
date: 2025-02-04
categories: [Writeup, VulnHub]
tags: [vulnhub, hacking, linux, lfi, medium, writeup, redteam, pentesting]
image_post: true
image: https://github.com/user-attachments/assets/c6ce3aca-878a-4858-8b01-71521da49efa
---

## Useful Skills

* Web Enumeration
* Local File Inclusion (LFI)
* LFI to RCE (abusing file_uploads + race condition)
* Cracking Protected Private SSH Key (ssh2john)

## Enumeration

### TCP Scan

 ```bash
rustscan -a 192.168.2.141 --ulimit 5000 -g
192.168.2.141 -> [80]
```

```bash
nmap -p80 -sCV 192.168.2.141 -oN tcpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-04 20:19 CET
Nmap scan report for 192.168.2.141
Host is up (0.00034s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Include me ...
MAC Address: 00:0C:29:3C:73:E6 (VMware)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.71 seconds
```

### UDP Scan

 ```bash
nmap -sU --top-ports 1500 --min-rate 5000 -n -Pn 192.168.2.141 -oN udpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-04 20:19 CET
Nmap scan report for 192.168.2.141
Host is up (0.00028s latency).
Not shown: 1496 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
944/udp   closed unknown
5353/udp  closed zeroconf
28493/udp closed unknown
31084/udp closed unknown
MAC Address: 00:0C:29:3C:73:E6 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 0.90 seconds
```

### HTTP Enumeration

Whatweb reporta un servidor Apache 2.4.38 y que se está utilizando PHP 7.4.7

```bash
whatweb http://192.168.2.141
http://192.168.2.141 [200 OK] Apache[2.4.38], Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.38 (Debian)], IP[192.168.2.141], JQuery, PHP[7.4.7], Script, Title[Include me ...], X-Powered-By[PHP/7.4.7]
```

Accediendo al servicio web en http://192.168.2.141 puedo observar una página web bastante por defecto, donde en la parte superior derecha existe posibilidad de loguearse o registrarse, pero los enlaces no redirige a ningún lado.

![imagen](https://github.com/user-attachments/assets/3d5310fe-94eb-47d6-a37d-af5778252d74)

Utilizo gobuster para realizar enumeración exahustiva de archivos y directorios

```bash
gobuster dir -u http://192.168.2.141 -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -q
/css                  (Status: 301) [Size: 312] [--> http://192.168.2.141/css/]
/img                  (Status: 301) [Size: 312] [--> http://192.168.2.141/img/]
/index.html           (Status: 200) [Size: 4674]
/index.php            (Status: 200) [Size: 4743]
/info.php             (Status: 200) [Size: 69776]
/server-status        (Status: 403) [Size: 278]
/vendor               (Status: 301) [Size: 315] [--> http://192.168.2.141/vendor/]
/.htpasswd            (Status: 403) [Size: 278]
/.htaccess            (Status: 403) [Size: 278]
/.hta                 (Status: 403) [Size: 278]
```

En el escaneo el unico recurso accesible que llama mi atención es info.php, este archivos permite visualizar la configuración PHP de un servidor

![imagen](https://github.com/user-attachments/assets/f6417c2e-1ef4-4f0d-bb65-baf7e34c6b33)

De cara a futuros ataques como ejecución remota de comandos voy a visualizar las disable_functions o funciona deshabilitadas, donde puedo comprobar si se permiten utilizar funciones para ejecutar comandos como system(), shell_exec(), passthru(), ente otras, puediendo ver que no existe ninguna función deshabilitada

![imagen](https://github.com/user-attachments/assets/241e3a49-d3ea-43a9-adb4-01648181d904)

## Vulnerability analysis

### Local File Inclusion (LFI)

En la página principal el título es Include me..., lo cual es una pista dando a entender que es posible que en algún lado se acontezca un LFI, por ello voy a utilizar ffuf para fuzzear por parámetros en la web apuntando hacia /etc/passwd, así /?FUZZ=/etc/passwd

```bash
ffuf -c -t 100 -fl 137 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u "http://192.168.2.141/?FUZZ=/etc/passwd"

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.2.141/?FUZZ=/etc/passwd
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 100
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response lines: 137
________________________________________________

filename                [Status: 200, Size: 1006, Words: 8, Lines: 27, Duration: 55ms]
```

Consigo obtener un parámetro existente, el cual es /?filename=, accedo a http://192.168.2.141/?filename=/etc/passwd, consigo ver el fichero passwd de la máquina victima, intento listar diferentes archivos de la máquina, pero no es posible, también intento utilizar diferentes wrappers pero no consigo obtener nada, se ve que es un LFI bastante limitado, tampoco es posible realizar un RCE a través de envenenar los logs de apache, ni utilizando la herramienta php-filter-chain

![imagen](https://github.com/user-attachments/assets/e40af21f-f2f5-4e46-a941-9880f1dc85ac)

### LFI to RCE file_uploads enabled (info.php)

En el info.php observo que file_upload se encuentra On, esto quiere decir que la posibilidad de subir archivos se encuentra habilitada, aunque no disponga de ningun campo de subida de archivo sería posible forzar una petición por POST al info.php donde se cree un archivo temporal con el contenido que yo desee

![imagen](https://github.com/user-attachments/assets/76c604c1-50d7-45c0-893a-ca7dd66086cc)

## Exploitation

### Abusing LFI to RCE file_uploads enabled + Race condition

Para realizar la ejecución de comandos a través del LFI y el file_uploads enabled, se debe de acontecer un Race Condition, existe un artículo donde se explica detalladamente el proceso

* [LFI2RCE via phpinfo](https://book.hacktricks.wiki/en/files/LFI-With-PHPInfo-Assistance.pdf)

Con el file_uploads On es posible interceptar la petición con BurpSuite y montar una estructura de subida de archivo, cambiando el método GET a POST y tramitando la petición se consige subir un archivo temporal, claro donde se produce el RCE es cuando disponemos del LFI y a través del mismo conseguimos apuntar al archivo subido.

* [Multipart Forms and Boundary Parameters](https://notes.benheater.com/books/web/page/multipart-forms-and-boundary-parameters)

![imagen](https://github.com/user-attachments/assets/463ab54e-d535-477f-a37f-dd5d6813bbfc)

![imagen](https://github.com/user-attachments/assets/42e1bb3b-74e9-4ab1-9adf-4ad28f037047)

El problema que se presenta es que son archivos temporales los que se crean, por ello se borran al poco tiempo, aquí es donde entra el Race Condition donde hay que intentar ejecutar la misma función muchas veces hasta que se de la condición donde en el mismo momento que se crea conseguimos apuntar al archivo y existe

