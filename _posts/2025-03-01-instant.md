---
description: >-
  Writeup de la máquina de dificultad media Instant de la página https://hackthebox.eu
title: HTB - Instant | (Difficulty Medium) - Linux
date: 2025-03-01
categories: [Writeup, Hack the Box]
tags: [htb, hacking, hack the box, linux, apktool, medium, writeup, redteam, pentesting]
image_post: true
image: https://github.com/user-attachments/assets/67468f2f-4cbe-42b2-8858-31c4815edee2
---

## Useful Skills

* Web enumeration
* APK analysis
* Information lekeage
* LFI through API vulnerable endpoint

## Enumeration

### TCP Scan

 ```bash
rustscan -a 10.10.11.37 --ulimit 5000 -g
10.10.11.37 -> [22,80]
```

```bash
nmap -p22,80 -sCV 10.10.11.37 -oN tcpScan
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 09:51 CET
Nmap scan report for 10.10.11.37 (10.10.11.37)
Host is up (0.035s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 31:83:eb:9f:15:f8:40:a5:04:9c:cb:3f:f6:ec:49:76 (ECDSA)
|_  256 6f:66:03:47:0e:8a:e0:03:97:67:5b:41:cf:e2:c7:c7 (ED25519)
80/tcp open  http    Apache httpd 2.4.58
|_http-title: Did not follow redirect to http://instant.htb/
|_http-server-header: Apache/2.4.58 (Ubuntu)
Service Info: Host: instant.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.74 seconds
```

### UDP Scan

 ```bash
nmap -sU --top-ports 1500 --min-rate 5000 -n -Pn 10.10.11.37 -oN udpScan
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-02 09:52 CET
Nmap scan report for 10.10.11.37
Host is up (0.32s latency).
Not shown: 1494 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
17338/udp closed unknown
17787/udp closed unknown
18617/udp closed unknown
19273/udp closed unknown
23073/udp closed unknown
33866/udp closed unknown

Nmap done: 1 IP address (1 host up) scanned in 1.62 seconds
```

> Hay que añadir el dominio instant.htb en el archivo de configuración /etc/hosts para que se pueda resolver el nombre de dominio a la dirección IP 10.10.11.37
{: .prompt-tip }

### HTTP Enumeration

Whatweb reporta un servidor Apache 2.4.58 y una version de Jquery desactualizada

```bash
whatweb http://instant.htb
http://instant.htb [200 OK] Apache[2.4.58], Bootstrap[4.0.0], Country[RESERVED][ZZ], Email[support@instant.htb], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.58 (Ubuntu)], IP[10.10.11.37], JQuery[3.2.1], Script, Title[Instant Wallet]
```

Accediendo a la página en http://instant.htb/ puedo observar una página web dedicada al envío de transacciones de dinero, al hacer clic sobre "Download now" se descarga una APK llamada instant.apk

![image](https://github.com/user-attachments/assets/503fe436-1d66-4596-8383-5016c844cb1b)

## Exploitation

### APK Data Exposure

Una vez he descargado la APK, utilizo la herramienta apktool para extraer y descompilar los recursos de la aplicación y poder analizarla

```bash
apktool d instant.apk
I: Using Apktool 2.7.0-dirty on instant.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: /root/.local/share/apktool/framework/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
I: Copying META-INF/services directory
```

Reviso el archivo strings.xml en res/values/strings.xml, donde puede haber información sensible como API keys, endpoints internos, contraseñas, entre otros, pero en este caso no consigo encontrar nada interesante, por ello filtro de forma recursiva por la palabra instant.htb con la finalidad de obtener en que puntos de la aplicación se involucra la cadena.

```bash
grep -r instant.htb
res/layout/activity_forgot_password.xml:        <TextView android:textSize="14.0sp" android:layout_width="fill_parent" android:layout_height="wrap_content" android:layout_margin="25.0dip" android:text="Please contact support@instant.htb to have your account recovered" android:fontFamily="sans-serif-condensed" android:textAlignment="center" />
res/xml/network_security_config.xml:        <domain includeSubdomains="true">mywalletv1.instant.htb</domain>
res/xml/network_security_config.xml:        <domain includeSubdomains="true">swagger-ui.instant.htb</domain>
smali/com/instantlabs/instant/AdminActivities.smali:    const-string v2, "http://mywalletv1.instant.htb/api/v1/view/profile"
smali/com/instantlabs/instant/LoginActivity.smali:    const-string v1, "http://mywalletv1.instant.htb/api/v1/login"
smali/com/instantlabs/instant/RegisterActivity.smali:    const-string p4, "http://mywalletv1.instant.htb/api/v1/register"
smali/com/instantlabs/instant/TransactionActivity.smali:    const-string v0, "http://mywalletv1.instant.htb/api/v1/initiate/transaction"
smali/com/instantlabs/instant/ProfileActivity.smali:    const-string v7, "http://mywalletv1.instant.htb/api/v1/view/profile"
smali/com/instantlabs/instant/TransactionActivity$2.smali:    const-string v1, "http://mywalletv1.instant.htb/api/v1/confirm/pin"
```

Consigo visualizar muchos subdominios, entre ellos uno que me llama la atención el cual es swagger-ui.instant.htb, ya que Swagger UI es una herramienta que permite visualizar, probar e interactuar con APIs desde el navegador, accedo a http://swagger-ui.instant.htb/ donde puedo confirmar mis sospechas.

![image](https://github.com/user-attachments/assets/2a64bae9-56c8-4cb9-bade-098fe3bdaec8)

> Hay que añadir el dominio swagger-ui.instant.htb y mywalletv1.instant.htb en el archivo de configuración /etc/hosts para que se pueda resolver el nombre de dominio a la dirección IP 10.10.11.37
{: .prompt-tip }

Observo un apartado Logs, el cual es un endpoint de la API /api/v1/admin/read/log, al parecer permite leer los registros de las transacciones de los usuarios especificando el nombre del archivo de registro como parámetro de consulta, a mi se me ocurre intentar apuntar hacia algun archivo local del servidor, como por ejemplo el fichero de usuarios /etc/passwd, al intentar apuntar al mismo obtengo un 401 UNAUTHORIZED, ya que necesito un token de autenticación para realizar las peticiones.

![image](https://github.com/user-attachments/assets/688bade9-61e7-41c2-b217-183d5d7a234f)

![image](https://github.com/user-attachments/assets/e5dd1fff-b7c7-4d23-994e-34219c53ab26)

![image](https://github.com/user-attachments/assets/a16c9af7-4fbf-4302-accb-1493fa65407c)

En la búsqueda recursiva de la palabra instant.htb observo un fichero en smali/com/instantlabs/instant/, el cual es AdminActivities.smali, observando el mismo puedo ver un JSON Web Token (JWT)
![image](https://github.com/user-attachments/assets/199cc2fa-86ac-42b2-9da9-7d17e91843ac)

Me dirijo a https://jwt.io/ para extraer los valores del JWT y observa de que esta compuesto puediendo ver diferentes valores como el rol, ID de cartera entre otras cosas 

![image](https://github.com/user-attachments/assets/2094b31b-9f60-4a8b-ac30-64320ca0e3f9)

### LFI through API vulnerable endpoint

Utilizo el JWT para autenticarme y arrastrar la autenticación en cada petición a los endpoints

![image](https://github.com/user-attachments/assets/f75fd373-8e8e-49bf-9f99-5c527478a569)

Estando autenticado pruebo nuevamenta a intentar apuntar al archivo local de la máquina /etc/passwd, pero obtengo un codigo de estado 500 Internal Server Error

![image](https://github.com/user-attachments/assets/023e6d5d-0e09-4fd4-bc27-10499b6d8b96)

![image](https://github.com/user-attachments/assets/2c742a0f-f5cb-4cbb-8d07-6f5578a5ae5b)

El error 500 puede ser por que esta intentando apuntar hacia archivos del directorio actual de trabajo, por lo que al retroceder directorios y apuntar al archivo /etc/passwd, consigo visualizar los usuarios del sistema, pudiendo ver que el endpoint /api/v1/admin/read/log es vulnerable a LFI

![image](https://github.com/user-attachments/assets/fbaf6404-467e-4346-aff2-561016d06781)

![image](https://github.com/user-attachments/assets/fa463bc3-c212-4be0-a2f4-b79c8c1d9c02)

## Gain access
