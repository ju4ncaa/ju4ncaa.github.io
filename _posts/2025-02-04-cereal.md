---
description: >-
  Writeup de la máquina de dificultad media Cereal de la página https://vulnhub.com
title: VulnHub - Cereal | (Difficulty Medium) - Linux
date: 2025-02-04
categories: [Writeup, VulnHub]
tags: [vulnhub, hacking, linux, medium, writeup, redteam, pentesting]
image_post: true
image: https://github.com/user-attachments/assets/433b74f9-173f-4c2e-bb49-9e65daa65de9
---

## Useful Skills

* FTP Enumeration
* SMB Enumeration
* Web Enumeration
* Subdomain Enumeration
* PHP Deserialization Attack - RCE
* 

## Enumeration

### TCP Scan

 ```bash
rustscan -a 192.168.2.140 --ulimit 5000 -g
192.168.2.140 -> [21,22,80,139,445,3306,11111,22223,22222,33333,33334,44441,44444,55551,55555]
```

```bash
nmap -p21,80,139,445,3306,22,11111,22222,22223,33333,33334,44441,44444,55551,55555 -sCV 192.168.2.140 -oN tcpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-04 15:03 CET
Nmap scan report for 192.168.2.140
Host is up (0.00029s latency).

PORT      STATE SERVICE         VERSION
21/tcp    open  ftp             vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 0        0               6 Apr 12  2021 pub
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.2.133
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp    open  ssh             OpenSSH 8.0 (protocol 2.0)
| ssh-hostkey: 
|   3072 00:24:2b:ae:41:ba:ac:52:d1:5d:4f:ad:00:ce:39:67 (RSA)
|   256 1a:e3:c7:37:52:2e:dc:dd:62:61:03:27:55:1a:86:6f (ECDSA)
|_  256 24:fd:e7:80:89:c5:57:fd:f3:e5:c9:2f:01:e1:6b:30 (ED25519)
80/tcp    open  http            Apache httpd 2.4.37 (())
|_http-title: Apache HTTP Server Test Page powered by: Rocky Linux
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.37 ()
139/tcp   open  netbios-ssn?
445/tcp   open  microsoft-ds?
3306/tcp  open  mysql?
| fingerprint-strings: 
|   NULL: 
|_    Host '192.168.2.133' is not allowed to connect to this MariaDB server
11111/tcp open  vce?
22222/tcp open  easyengine?
|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)
22223/tcp open  unknown
33333/tcp open  dgi-serv?
33334/tcp open  speedtrace?
44441/tcp open  http            Apache httpd 2.4.37 (())
|_http-server-header: Apache/2.4.37 ()
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
44444/tcp open  cognex-dataman?
55551/tcp open  unknown
55555/tcp open  unknown
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V=7.94SVN%I=7%D=2/4%Time=67A21E42%P=x86_64-pc-linux-gnu%r(
SF:NULL,4C,"H\0\0\x01\xffj\x04Host\x20'192\.168\.2\.133'\x20is\x20not\x20a
SF:llowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server");
MAC Address: 00:0C:29:60:7E:8D (VMware)
Service Info: OS: Unix

Host script results:
|_smb2-time: Protocol negotiation failed (SMB2)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.58 seconds
```

### UDP Scan

 ```bash
nmap -sU --top-ports 1500 --min-rate 5000 -n -Pn 192.168.2.140 -oN udpScan
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-04 15:10 CET
Nmap scan report for 192.168.2.140
Host is up (0.00024s latency).
Not shown: 1494 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
17533/udp closed unknown
26420/udp closed unknown
28664/udp closed unknown
29981/udp closed unknown
40915/udp closed unknown
55043/udp closed unknown
MAC Address: 00:0C:29:60:7E:8D (VMware)

Nmap done: 1 IP address (1 host up) scanned in 0.90 seconds
```

### FTP Enumeration

La versión de FTP es vsftpd 3.0.3, busco posibles vulnerabilidades o exploits pero no encuentro nada interesante, por otro lado nmap ha reportado anonymous login, me logueo como usuario anonymous

```bash
ftp 192.168.2.140
Connected to 192.168.2.140.
220 (vsFTPd 3.0.3)
Name (192.168.2.140:ju4ncaa): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>
```

Listo los directorios compartidos, observo uno llamado pub, accedo al mismo pero no hay ningún contenido.

```bash
ftp> dir
229 Entering Extended Passive Mode (|||19632|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        0               6 Apr 12  2021 pub
226 Directory send OK.
```

```bash
250 Directory successfully changed.
ftp> dir
229 Entering Extended Passive Mode (|||49162|)
150 Here comes the directory listing.
226 Directory send OK.
```

Intento subir un archivo al directorio pub, por ejemplo el escaneo TCP realizado con nmap, pero no se me permite, por lo que de momento el vector de ataque por FTP concluye

```bash
ftp> put ../scan/tcpScan 
local: ../scan/tcpScan remote: ../scan/tcpScan
229 Entering Extended Passive Mode (|||53429|)
550 Permission denied.
```

### SMB Enumeration 

El puerto 445 SMB se encuentra abierto, intento listar con un null session recursos compartidos a nivel de red, tanto con smbclient como con smbmap pero no se me permite, por lo que de momento el vector de ataque por SMB concluye

```bash
smbclient -L 192.168.2.140 -N
Protocol negotiation (with timeout 20000 ms) timed out against server 192.168.2.140
```

```bash
smbmap -H 192.168.2.140 -u 'null'
[!] Authentication error on 192.168.2.140
```

### HTTP Enumeration

En el puerto 80/TCP Whatweb no reporta nada interesante 

```bash
whatweb http://192.168.2.140/
http://192.168.2.140/ [403 Forbidden] Apache[2.4.37], Country[RESERVED][ZZ], Email[webmaster@example.com], HTML5, HTTPServer[Apache/2.4.37 ()], IP[192.168.2.140], PoweredBy[:], Title[Apache HTTP Server Test Page powered by: Rocky Linux]
```

Accediendo al servicio web en http://192.168.2.140 puedo observar la página por defecto de Apache

![imagen](https://github.com/user-attachments/assets/b2a6597f-68f2-4fa6-ae02-d0cbed56a526)

Utilizo gobuster para realizar una enumeración exhaustiva de directorios

```bash
gobuster dir -u http://192.168.2.140/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -q
/.htpasswd            (Status: 403) [Size: 199]
/.hta                 (Status: 403) [Size: 199]
/.htaccess            (Status: 403) [Size: 199]
/admin                (Status: 301) [Size: 235] [--> http://192.168.2.140/admin/]
/blog                 (Status: 301) [Size: 234] [--> http://192.168.2.140/blog/]
/cgi-bin/             (Status: 403) [Size: 199]
/phpinfo.php          (Status: 200) [Size: 76260]
```

En el escaneo obtengo directorios y archivos interesantes, phpinfo.php, /blog y /admin son los recursos en los que pongo el foco, accedo a phpinfo.php y veo que se trata del archivo que permite mostrar información detallada sobre la configuración PHP en un servidor.

![imagen](https://github.com/user-attachments/assets/5247f4a9-737e-4a00-bd06-26b70b929161)

Accedo a  http://192.168.2.140/blog y veo que se trata de un Wordpress, el cual no se termina de ver bien ya que todos los recursos apuntan a cereal.ctf

![imagen](https://github.com/user-attachments/assets/08b4926b-94f4-42af-beeb-fb87fc458a2f)

![imagen](https://github.com/user-attachments/assets/f9a1b2f9-e2d4-4214-bd12-e8447619e529)

> Hay que añadir el dominio cereal.ctf en el archivo de configuración /etc/hosts para que se pueda resolver el nombre de dominio a la dirección IP 192.168.2.140
{: .prompt-tip }

Recargo de nuevo y observo una página Wordpress con una configuración bastante por defecto, tambien consigo ver la versión del mismo, se trata de un Wordpress 6.7.1

![imagen](https://github.com/user-attachments/assets/f9d980d4-9be6-4fff-bc7f-12093dc4e356)

```bash
whatweb http://192.168.2.140/blog/
http://192.168.2.140/blog/ [200 OK] Apache[2.4.37], Country[RESERVED][ZZ], HTML5, HTTPServer[Apache/2.4.37 ()], IP[192.168.2.140], MetaGenerator[WordPress 6.7.1], PHP[7.2.24], PoweredBy[--], Script, Title[Cereal], UncommonHeaders[link], WordPress[6.7.1], X-Powered-By[PHP/7.2.24]
```

Accedo a http://cereal.ctf/admin y observo un panel de login, en el cual trato de realizar diferentes inyecciones SQL pero no obtengo resultado, también podría tratar de realizar fuerza bruta contra el panel de autenticación, pero de momento esa opción la descarto.

![imagen](https://github.com/user-attachments/assets/8e977b0e-6e95-4ef5-bbab-6a6d509286b4)

En el puerto 44441/tcp Whatweb no reporta nada interesante

```bash
whatweb http://192.168.2.140:44441/
http://192.168.2.140:44441/ [200 OK] Apache[2.4.37], Country[RESERVED][ZZ], HTTPServer[Apache/2.4.37 ()], IP[192.168.2.140]
```

Accedo a http://cereal.ctf:44441 y veo un texto que dice Coming soon...

![imagen](https://github.com/user-attachments/assets/d75de3ad-b138-4b62-bb72-749117ad765d)

Utilizo wfuzz para realizar enumeracion de subdominios, consiguiendo encontrar el subdominio secure.cereal.ctf

```bash
wfuzz -c --hw=2 --hc=404,403 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://cereal.ctf:44441 -H "Host: FUZZ.cereal.ctf"
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                       
=====================================================================
000000036:   200        49 L     140 W      1538 Ch     "secure"
```

> Hay que añadir el dominio secure.cereal.ctf en el archivo de configuración /etc/hosts para que se pueda resolver el nombre de dominio a la dirección IP 192.168.2.140
{: .prompt-tip }

Accedo a http://secure.cereal.ctf y observo una página Ping Test, suopongo que permitirá enviar ping

![imagen](https://github.com/user-attachments/assets/0f0e6304-7213-46e3-84ae-64c6b1950f97)
